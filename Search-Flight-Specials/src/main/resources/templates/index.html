<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Flight Search</title>
<meta name="_csrf" th:content="${_csrf.token}">
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script th:inline="javascript">

	var token = "";
	
	fetch('/api/get-amadeusKey') 
    .then(response => response.json()) 
    .then(data => {
        var key = data.key;
        var secret = data.secret;
        fetch('https://test.api.amadeus.com/v1/security/oauth2/token', {
    		body: `grant_type=client_credentials&client_id=${key}&client_secret=${secret}`,
    		headers: {
    		  "Content-Type": "application/x-www-form-urlencoded"
    		},
    		method: "POST"
    		}
        )
        .then(res => res.json())
        .then(data => {
    		token = data.access_token;
    	})
    	.catch(error => console.error('Error:', error));
    })
    .catch(error => {
        console.error('Error fetching credentials:', error);
    });
	
</script>
</head>
<body>
	<h2>格安航空券を簡単に比較＆予約</h2>
	<form id="flight-search-form">
		<input type="radio" name="ticketOption" value="1" checked>片道
		<input type="radio" name="ticketOption" value="2">往復
		<br>
		<label for="origin">出発:</label> 
		<input type="text" id="origin" name="origin" required>
		<div id="originSearchResults"></div>
		<br>
		<label for="destination">到着:</label>
		<input type="text" id="destination" name="destination" required>
		<div id="destinationSearchResults"></div>
		<br>
		<input type="text" id="departureDate" name="departureDate" required>
		<input type="text" id="arrivalDate" name="arrivalDate">
		<br>
		<button type="submit">Search</button>
	</form>

	<div id="results"></div>
</body>
<script type="text/javascript" th:src="@{/js/searchFlight.js}"></script>
</html>